Datamatic=function(t){this._userID=t},Datamatic.prototype={chart:function(t,e){return t&&-1==t.indexOf("/")?new Datamatic.Chart(this._userID+"/"+t,e):new Datamatic.Chart(t,e)}},Datamatic.Utils={},Datamatic.Utils.DelayedTask=function(t,e){var n=null,i=function(){n=null,t()},a=function(t){null==n&&(n=setTimeout(i,t||e))};return a.delay=function(t){n&&clearTimeout(n),n=setTimeout(i,t||e)},a.schedule=a,a.call=function(){this.cancel(),t()},a.cancel=function(){n&&clearTimeout(n),n=null},a.isPending=function(){return n},a},Datamatic.Ajax={},Datamatic.Ajax.x=function(){if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;for(var t,e=["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"],n=0;n<e.length;n++)try{t=new ActiveXObject(e[n]);break}catch(i){}return t},Datamatic.Ajax.send=function(t,e,n,i,a){var o=Datamatic.Ajax.x();o.open(n,t,a),o.onreadystatechange=function(){4==o.readyState&&e(o.responseText)},"POST"==n&&o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.send(i)},Datamatic.Ajax.get=function(t,e,n,i){var a=[],o=new Datamatic.Promise;for(var s in e)a.push(encodeURIComponent(s)+"="+encodeURIComponent(e[s]));var r="";return a.length&&(r=-1==t.indexOf("?")?"?"+a.join("&"):a.join("&")),Datamatic.Ajax.send(t+r,function(t){"function"==typeof n&&n.apply(this,arguments),o.resolve(t)},"GET",null,i),o},Datamatic.Ajax.json=function(){var t=new Datamatic.Promise;return Datamatic.Ajax.get.apply(Datamatic.Ajax,arguments).then(function(e){t.resolve(JSON.parse(e))}),t},Datamatic.Ajax.post=function(t,e,n,i){var a=[];for(var o in e)a.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return Datamatic.Ajax.send(t,function(t){"function"==typeof n&&n.apply(this,arguments),promise.resolve(t)},"POST",a.join("&"),i),promise},Datamatic.Promise=function(){this._thens=[]},Datamatic.Promise.prototype={then:function(t,e){this._thens.push({resolve:t,reject:e})},resolve:function(t){this._complete("resolve",t)},reject:function(t){this._complete("reject",t)},_complete:function(t,e){this.then="resolve"===t?function(t){t&&t(e)}:function(t,n){n&&n(e)},this.resolve=this.reject=function(){throw new Error("Promise already completed.")};for(var n,i=0;n=this._thens[i++];)n[t]&&n[t](e);delete this._thens}},Datamatic.Chart=function(t,e){this._id=t,this._options=e};var isIE=function(){var t=navigator.userAgent.toLowerCase();return-1!=t.indexOf("msie")?parseInt(t.split("msie")[1]):!1};Datamatic.Chart.prototype={_postSendboxMessage:function(t){isIE()&&isIE()<10&&(t=JSON.stringify(t)),this._iframe.contentWindow.postMessage(t,"*")},render:function(t){var e=new Datamatic.Promise;return this._iframe=document.createElement("IFRAME"),this._iframe.src="http://sandbox.datamatic.io/echarts/2",this._iframe.setAttribute("frameborder","0"),this._iframe.onload=function(){if(!this._id)throw new Error("Chart ID has to be provided.");Datamatic.Ajax.get("http://public.datamatic.io/echarts/2/"+this._id+".json",{},function(t){var n=JSON.parse(t);this._renderSandbox(n.template,JSON.parse(decodeURIComponent(escape(window.atob(n.settings)))),JSON.parse(decodeURIComponent(escape(window.atob(n.data)))),decodeURIComponent(escape(window.atob(n.code)))),e.resolve()}.bind(this))}.bind(this),t.appendChild(this._iframe),e},_renderSandbox:function(t,e,n,i){"undefined"!=typeof this._options.width&&(e.width=this._options.width),"undefined"!=typeof this._options.height&&(e.height=this._options.height),this._iframe.setAttribute("width",e.width),this._iframe.setAttribute("height",e.height),this._iframe.setAttribute("scrolling","no"),e.top=0,e.left=0,this._settings=e,this._data=n,this._postSendboxMessage({action:"render",template:t,settings:e}),i&&this._postSendboxMessage({action:"setCode",code:i}),this._postSendboxMessage({action:"update",template:t,settings:e,data:n})},setData:function(t){t=t||[];var e=function(t){var n=t.children?t.children.map(e):[];return{size:t.value,name:t.name,children:n}},n={children:[{name:"start",size:10,children:t.map(e)}]};this._postSendboxMessage({action:"update",data:n}),this._data=n},setProperties:function(t){this._settings=t,this._postSendboxMessage({action:"update",settings:t})}};