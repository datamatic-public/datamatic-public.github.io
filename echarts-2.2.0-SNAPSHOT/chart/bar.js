define("echarts/chart/bar",["require","./base","zrender/shape/Rectangle","../component/axis","../component/grid","../component/dataZoom","../config","../util/ecData","zrender/tool/util","zrender/tool/color","../chart"],function(t){function e(t,e,o,s,r){i.call(this,t,e,o,s,r),this.refresh(s)}var i=t("./base"),o=t("zrender/shape/Rectangle");t("../component/axis"),t("../component/grid"),t("../component/dataZoom");var s=t("../config");s.bar={zlevel:0,z:2,clickable:!0,legendHoverLink:!0,xAxisIndex:0,yAxisIndex:0,barMinHeight:0,barGap:"30%",barCategoryGap:"20%",itemStyle:{normal:{barBorderColor:"#fff",barBorderRadius:0,barBorderWidth:0,label:{show:!1}},emphasis:{barBorderColor:"#fff",barBorderRadius:0,barBorderWidth:0,label:{show:!1}}}};var r=t("../util/ecData"),n=t("zrender/tool/util"),a=t("zrender/tool/color");return e.prototype={type:s.CHART_TYPE_BAR,_buildShape:function(){this._buildPosition()},_buildNormal:function(t,e,i,r,n){for(var a,h,l,d,c,p,u,g,f,m,y,_,v=this.series,x=i[0][0],b=v[x],S="horizontal"==n,T=this.component.xAxis,z=this.component.yAxis,C=S?T.getAxis(b.xAxisIndex):z.getAxis(b.yAxisIndex),w=this._mapSize(C,i),L=w.gap,M=w.barGap,E=w.barWidthMap,A=w.barMaxWidthMap,k=w.barWidth,I=w.barMinHeightMap,O=w.interval,P=this.deepQuery([this.ecTheme,s],"island.r"),R=0,D=e;D>R&&null!=C.getNameByIndex(R);R++){S?d=C.getCoordByIndex(R)-L/2:c=C.getCoordByIndex(R)+L/2;for(var B=0,N=i.length;N>B;B++){var H=v[i[B][0]].yAxisIndex||0,F=v[i[B][0]].xAxisIndex||0;a=S?z.getAxis(H):T.getAxis(F),u=p=f=g=a.getCoord(0);for(var W=0,Y=i[B].length;Y>W;W++)x=i[B][W],b=v[x],y=b.data[R],_=this.getDataFromOption(y,"-"),r[x]=r[x]||{min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,sum:0,counter:0,average:0},l=Math.min(A[x]||Number.MAX_VALUE,E[x]||k),"-"!==_&&(_>0?(h=W>0?a.getCoordSize(_):S?u-a.getCoord(_):a.getCoord(_)-u,1===Y&&I[x]>h&&(h=I[x]),S?(p-=h,c=p):(d=p,p+=h)):0>_?(h=W>0?a.getCoordSize(_):S?a.getCoord(_)-f:f-a.getCoord(_),1===Y&&I[x]>h&&(h=I[x]),S?(c=g,g+=h):(g-=h,d=g)):(h=0,S?(p-=h,c=p):(d=p,p+=h)),r[x][R]=S?d+l/2:c-l/2,r[x].min>_&&(r[x].min=_,S?(r[x].minY=c,r[x].minX=r[x][R]):(r[x].minX=d+h,r[x].minY=r[x][R])),r[x].max<_&&(r[x].max=_,S?(r[x].maxY=c,r[x].maxX=r[x][R]):(r[x].maxX=d+h,r[x].maxY=r[x][R])),r[x].sum+=_,r[x].counter++,R%O===0&&(m=this._getBarItem(x,R,C.getNameByIndex(R),d,c-(S?0:l),S?l:h,S?h:l,S?"vertical":"horizontal"),this.shapeList.push(new o(m))));for(var W=0,Y=i[B].length;Y>W;W++)x=i[B][W],b=v[x],y=b.data[R],_=this.getDataFromOption(y,"-"),l=Math.min(A[x]||Number.MAX_VALUE,E[x]||k),"-"==_&&this.deepQuery([y,b,this.option],"calculable")&&(S?(p-=P,c=p):(d=p,p+=P),m=this._getBarItem(x,R,C.getNameByIndex(R),d,c-(S?0:l),S?l:P,S?P:l,S?"vertical":"horizontal"),m.hoverable=!1,m.draggable=!1,m.style.lineWidth=1,m.style.brushType="stroke",m.style.strokeColor=b.calculableHolderColor||this.ecTheme.calculableHolderColor||s.calculableHolderColor,this.shapeList.push(new o(m)));S?d+=l+M:c-=l+M}}this._calculMarkMapXY(r,i,S?"y":"x")},_buildHorizontal:function(t,e,i,o){return this._buildNormal(t,e,i,o,"horizontal")},_buildVertical:function(t,e,i,o){return this._buildNormal(t,e,i,o,"vertical")},_buildOther:function(t,e,i,s){for(var r=this.series,n=0,a=i.length;a>n;n++)for(var h=0,l=i[n].length;l>h;h++){var d=i[n][h],c=r[d],p=c.xAxisIndex||0,u=this.component.xAxis.getAxis(p),g=u.getCoord(0),f=c.yAxisIndex||0,m=this.component.yAxis.getAxis(f),y=m.getCoord(0);s[d]=s[d]||{min0:Number.POSITIVE_INFINITY,min1:Number.POSITIVE_INFINITY,max0:Number.NEGATIVE_INFINITY,max1:Number.NEGATIVE_INFINITY,sum0:0,sum1:0,counter0:0,counter1:0,average0:0,average1:0};for(var _=0,v=c.data.length;v>_;_++){var x=c.data[_],b=this.getDataFromOption(x,"-");if(b instanceof Array){var S,T,z=u.getCoord(b[0]),C=m.getCoord(b[1]),w=[x,c],L=this.deepQuery(w,"barWidth")||10,M=this.deepQuery(w,"barHeight");null!=M?(S="horizontal",b[0]>0?(L=z-g,z-=L):L=b[0]<0?g-z:0,T=this._getBarItem(d,_,b[0],z,C-M/2,L,M,S)):(S="vertical",b[1]>0?M=y-C:b[1]<0?(M=C-y,C-=M):M=0,T=this._getBarItem(d,_,b[0],z-L/2,C,L,M,S)),this.shapeList.push(new o(T)),z=u.getCoord(b[0]),C=m.getCoord(b[1]),s[d].min0>b[0]&&(s[d].min0=b[0],s[d].minY0=C,s[d].minX0=z),s[d].max0<b[0]&&(s[d].max0=b[0],s[d].maxY0=C,s[d].maxX0=z),s[d].sum0+=b[0],s[d].counter0++,s[d].min1>b[1]&&(s[d].min1=b[1],s[d].minY1=C,s[d].minX1=z),s[d].max1<b[1]&&(s[d].max1=b[1],s[d].maxY1=C,s[d].maxX1=z),s[d].sum1+=b[1],s[d].counter1++}}}this._calculMarkMapXY(s,i,"xy")},_mapSize:function(t,e,i){var o,s,r=this._findSpecialBarSzie(e,i),n=r.barWidthMap,a=r.barMaxWidthMap,h=r.barMinHeightMap,l=r.sBarWidthCounter,d=r.sBarWidthTotal,c=r.barGap,p=r.barCategoryGap,u=1;if(e.length!=l){if(i)o=t.getGap(),c=0,s=+(o/e.length).toFixed(2),0>=s&&(u=Math.floor(e.length/o),s=1);else if(o="string"==typeof p&&p.match(/%$/)?(t.getGap()*(100-parseFloat(p))/100).toFixed(2)-0:t.getGap()-p,"string"==typeof c&&c.match(/%$/)?(c=parseFloat(c)/100,s=+((o-d)/((e.length-1)*c+e.length-l)).toFixed(2),c=s*c):(c=parseFloat(c),s=+((o-d-c*(e.length-1))/(e.length-l)).toFixed(2)),0>=s)return this._mapSize(t,e,!0)}else if(o=l>1?"string"==typeof p&&p.match(/%$/)?+(t.getGap()*(100-parseFloat(p))/100).toFixed(2):t.getGap()-p:d,s=0,c=l>1?+((o-d)/(l-1)).toFixed(2):0,0>c)return this._mapSize(t,e,!0);return this._recheckBarMaxWidth(e,n,a,h,o,s,c,u)},_findSpecialBarSzie:function(t,e){for(var i,o,s,r,n=this.series,a={},h={},l={},d=0,c=0,p=0,u=t.length;u>p;p++)for(var g={barWidth:!1,barMaxWidth:!1},f=0,m=t[p].length;m>f;f++){var y=t[p][f],_=n[y];if(!e){if(g.barWidth)a[y]=i;else if(i=this.query(_,"barWidth"),null!=i){a[y]=i,c+=i,d++,g.barWidth=!0;for(var v=0,x=f;x>v;v++){var b=t[p][v];a[b]=i}}if(g.barMaxWidth)h[y]=o;else if(o=this.query(_,"barMaxWidth"),null!=o){h[y]=o,g.barMaxWidth=!0;for(var v=0,x=f;x>v;v++){var b=t[p][v];h[b]=o}}}l[y]=this.query(_,"barMinHeight"),s=null!=s?s:this.query(_,"barGap"),r=null!=r?r:this.query(_,"barCategoryGap")}return{barWidthMap:a,barMaxWidthMap:h,barMinHeightMap:l,sBarWidth:i,sBarMaxWidth:o,sBarWidthCounter:d,sBarWidthTotal:c,barGap:s,barCategoryGap:r}},_recheckBarMaxWidth:function(t,e,i,o,s,r,n,a){for(var h=0,l=t.length;l>h;h++){var d=t[h][0];i[d]&&i[d]<r&&(s-=r-i[d])}return{barWidthMap:e,barMaxWidthMap:i,barMinHeightMap:o,gap:s,barWidth:r,barGap:n,interval:a}},_getBarItem:function(t,e,i,o,s,n,h,l){var d,c=this.series,p=c[t],u=p.data[e],g=this._sIndex2ColorMap[t],f=[u,p],m=this.deepMerge(f,"itemStyle.normal"),y=this.deepMerge(f,"itemStyle.emphasis"),_=m.barBorderWidth;d={zlevel:this.getZlevelBase(),z:this.getZBase(),clickable:this.deepQuery(f,"clickable"),style:{x:o,y:s,width:n,height:h,brushType:"both",color:this.getItemStyleColor(this.deepQuery(f,"itemStyle.normal.color")||g,t,e,u),radius:m.barBorderRadius,lineWidth:_,strokeColor:m.barBorderColor},highlightStyle:{color:this.getItemStyleColor(this.deepQuery(f,"itemStyle.emphasis.color"),t,e,u),radius:y.barBorderRadius,lineWidth:y.barBorderWidth,strokeColor:y.barBorderColor},_orient:l};var v=d.style;d.highlightStyle.color=d.highlightStyle.color||("string"==typeof v.color?a.lift(v.color,-.3):v.color),v.x=Math.floor(v.x),v.y=Math.floor(v.y),v.height=Math.ceil(v.height),v.width=Math.ceil(v.width),_>0&&v.height>_&&v.width>_?(v.y+=_/2,v.height-=_,v.x+=_/2,v.width-=_):v.brushType="fill",d.highlightStyle.textColor=d.highlightStyle.color,d=this.addLabel(d,p,u,i,l);var x=v.textPosition;if("insideLeft"===x||"insideRight"===x||"insideTop"===x||"insideBottom"===x){var b=5;switch(x){case"insideLeft":v.textX=v.x+b,v.textY=v.y+v.height/2,v.textAlign="left",v.textBaseline="middle";break;case"insideRight":v.textX=v.x+v.width-b,v.textY=v.y+v.height/2,v.textAlign="right",v.textBaseline="middle";break;case"insideTop":v.textX=v.x+v.width/2,v.textY=v.y+b/2,v.textAlign="center",v.textBaseline="top";break;case"insideBottom":v.textX=v.x+v.width/2,v.textY=v.y+v.height-b/2,v.textAlign="center",v.textBaseline="bottom"}v.textPosition="specific",v.textColor=v.textColor||"#fff"}return this.deepQuery([u,p,this.option],"calculable")&&(this.setCalculable(d),d.draggable=!0),r.pack(d,c[t],t,c[t].data[e],e,i),d},getMarkCoord:function(t,e){var i,o,s=this.series[t],r=this.xMarkMap[t],n=this.component.xAxis.getAxis(s.xAxisIndex),a=this.component.yAxis.getAxis(s.yAxisIndex);if(!e.type||"max"!==e.type&&"min"!==e.type&&"average"!==e.type)if(r.isHorizontal){i="string"==typeof e.xAxis&&n.getIndexByName?n.getIndexByName(e.xAxis):e.xAxis||0;var h=r[i];h=null!=h?h:"string"!=typeof e.xAxis&&n.getCoordByIndex?n.getCoordByIndex(e.xAxis||0):n.getCoord(e.xAxis||0),o=[h,a.getCoord(e.yAxis||0)]}else{i="string"==typeof e.yAxis&&a.getIndexByName?a.getIndexByName(e.yAxis):e.yAxis||0;var l=r[i];l=null!=l?l:"string"!=typeof e.yAxis&&a.getCoordByIndex?a.getCoordByIndex(e.yAxis||0):a.getCoord(e.yAxis||0),o=[n.getCoord(e.xAxis||0),l]}else{var d=null!=e.valueIndex?e.valueIndex:null!=r.maxX0?"1":"";o=[r[e.type+"X"+d],r[e.type+"Y"+d],r[e.type+"Line"+d],r[e.type+d]]}return o},refresh:function(t){t&&(this.option=t,this.series=t.series),this.backupShapeList(),this._buildShape()},addDataAnimation:function(t){for(var e=this.series,i={},o=0,s=t.length;s>o;o++)i[t[o][0]]=t[o];for(var n,a,h,l,d,c,p,o=this.shapeList.length-1;o>=0;o--)if(c=r.get(this.shapeList[o],"seriesIndex"),i[c]&&!i[c][3]&&"rectangle"===this.shapeList[o].type){if(p=r.get(this.shapeList[o],"dataIndex"),d=e[c],i[c][2]&&p===d.data.length-1){this.zr.delShape(this.shapeList[o].id);continue}if(!i[c][2]&&0===p){this.zr.delShape(this.shapeList[o].id);continue}"horizontal"===this.shapeList[o]._orient?(l=this.component.yAxis.getAxis(d.yAxisIndex||0).getGap(),h=i[c][2]?-l:l,n=0):(a=this.component.xAxis.getAxis(d.xAxisIndex||0).getGap(),n=i[c][2]?a:-a,h=0),this.shapeList[o].position=[0,0],this.zr.animate(this.shapeList[o].id,"").when(this.query(this.option,"animationDurationUpdate"),{position:[n,h]}).start()}}},n.inherits(e,i),t("../chart").define("bar",e),e});