define("echarts/chart/k",["require","./base","../util/shape/Candle","../component/axis","../component/grid","../component/dataZoom","../config","../util/ecData","zrender/tool/util","../chart"],function(t){function e(t,e,o,s,n){i.call(this,t,e,o,s,n),this.refresh(s)}var i=t("./base"),o=t("../util/shape/Candle");t("../component/axis"),t("../component/grid"),t("../component/dataZoom");var s=t("../config");s.k={zlevel:0,z:2,clickable:!0,hoverable:!0,legendHoverLink:!1,xAxisIndex:0,yAxisIndex:0,itemStyle:{normal:{color:"#fff",color0:"#00aa11",lineStyle:{width:1,color:"#ff3200",color0:"#00aa11"}},emphasis:{}}};var n=t("../util/ecData"),a=t("zrender/tool/util");return e.prototype={type:s.CHART_TYPE_K,_buildShape:function(){var t=this.series;this.selectedMap={};for(var e,i={top:[],bottom:[]},o=0,n=t.length;n>o;o++)t[o].type===s.CHART_TYPE_K&&(t[o]=this.reformOption(t[o]),this.legendHoverLink=t[o].legendHoverLink||this.legendHoverLink,e=this.component.xAxis.getAxis(t[o].xAxisIndex),e.type===s.COMPONENT_TYPE_AXIS_CATEGORY&&i[e.getPosition()].push(o));for(var a in i)i[a].length>0&&this._buildSinglePosition(a,i[a]);this.addShapeList()},_buildSinglePosition:function(t,e){var i=this._mapData(e),o=i.locationMap,s=i.maxDataLength;if(0!==s&&0!==o.length){this._buildHorizontal(e,s,o);for(var n=0,a=e.length;a>n;n++)this.buildMark(e[n])}},_mapData:function(t){for(var e,i,o=this.series,s=this.component.legend,n=[],a=0,r=0,h=t.length;h>r;r++)e=o[t[r]],i=e.name,this.selectedMap[i]=s?s.isSelected(i):!0,this.selectedMap[i]&&n.push(t[r]),a=Math.max(a,e.data.length);return{locationMap:n,maxDataLength:a}},_buildHorizontal:function(t,e,i){for(var o,s,n,a,r,h,l,d,c,p,u=this.series,g={},f=0,m=i.length;m>f;f++){o=i[f],s=u[o],n=s.xAxisIndex||0,a=this.component.xAxis.getAxis(n),l=s.barWidth||Math.floor(a.getGap()/2),p=s.barMaxWidth,p&&l>p&&(l=p),r=s.yAxisIndex||0,h=this.component.yAxis.getAxis(r),g[o]=[];for(var y=0,_=e;_>y&&null!=a.getNameByIndex(y);y++)d=s.data[y],c=this.getDataFromOption(d,"-"),"-"!==c&&4==c.length&&g[o].push([a.getCoordByIndex(y),l,h.getCoord(c[0]),h.getCoord(c[1]),h.getCoord(c[2]),h.getCoord(c[3]),y,a.getNameByIndex(y)])}this._buildKLine(t,g)},_buildKLine:function(t,e){for(var i,o,n,a,r,h,l,d,c,p,u,g,f,m,y,_,v,x=this.series,b=0,S=t.length;S>b;b++)if(v=t[b],u=x[v],m=e[v],this._isLarge(m)&&(m=this._getLargePointList(m)),u.type===s.CHART_TYPE_K&&null!=m){g=u,i=this.query(g,"itemStyle.normal.lineStyle.width"),o=this.query(g,"itemStyle.normal.lineStyle.color"),n=this.query(g,"itemStyle.normal.lineStyle.color0"),a=this.query(g,"itemStyle.normal.color"),r=this.query(g,"itemStyle.normal.color0"),h=this.query(g,"itemStyle.emphasis.lineStyle.width"),l=this.query(g,"itemStyle.emphasis.lineStyle.color"),d=this.query(g,"itemStyle.emphasis.lineStyle.color0"),c=this.query(g,"itemStyle.emphasis.color"),p=this.query(g,"itemStyle.emphasis.color0");for(var T=0,z=m.length;z>T;T++)y=m[T],f=u.data[y[6]],g=f,_=y[3]<y[2],this.shapeList.push(this._getCandle(v,y[6],y[7],y[0],y[1],y[2],y[3],y[4],y[5],_?this.query(g,"itemStyle.normal.color")||a:this.query(g,"itemStyle.normal.color0")||r,this.query(g,"itemStyle.normal.lineStyle.width")||i,_?this.query(g,"itemStyle.normal.lineStyle.color")||o:this.query(g,"itemStyle.normal.lineStyle.color0")||n,_?this.query(g,"itemStyle.emphasis.color")||c||a:this.query(g,"itemStyle.emphasis.color0")||p||r,this.query(g,"itemStyle.emphasis.lineStyle.width")||h||i,_?this.query(g,"itemStyle.emphasis.lineStyle.color")||l||o:this.query(g,"itemStyle.emphasis.lineStyle.color0")||d||n))}},_isLarge:function(t){return t[0][1]<.5},_getLargePointList:function(t){for(var e=this.component.grid.getWidth(),i=t.length,o=[],s=0;e>s;s++)o[s]=t[Math.floor(i/e*s)];return o},_getCandle:function(t,e,i,s,a,r,h,l,d,c,p,u,g,f,m){var y=this.series,_={zlevel:this.getZlevelBase(),z:this.getZBase(),clickable:this.deepQuery([y[t].data[e],y[t]],"clickable"),hoverable:this.deepQuery([y[t].data[e],y[t]],"hoverable"),style:{x:s,y:[r,h,l,d],width:a,color:c,strokeColor:u,lineWidth:p,brushType:"both"},highlightStyle:{color:g,strokeColor:m,lineWidth:f},_seriesIndex:t};return n.pack(_,y[t],t,y[t].data[e],e,i),_=new o(_)},getMarkCoord:function(t,e){var i=this.series[t],o=this.component.xAxis.getAxis(i.xAxisIndex),s=this.component.yAxis.getAxis(i.yAxisIndex);return["string"!=typeof e.xAxis&&o.getCoordByIndex?o.getCoordByIndex(e.xAxis||0):o.getCoord(e.xAxis||0),"string"!=typeof e.yAxis&&s.getCoordByIndex?s.getCoordByIndex(e.yAxis||0):s.getCoord(e.yAxis||0)]},refresh:function(t){t&&(this.option=t,this.series=t.series),this.backupShapeList(),this._buildShape()},addDataAnimation:function(t){for(var e=this.series,i={},o=0,s=t.length;s>o;o++)i[t[o][0]]=t[o];for(var a,r,h,l,d,c,o=0,s=this.shapeList.length;s>o;o++)if(d=this.shapeList[o]._seriesIndex,i[d]&&!i[d][3]&&"candle"===this.shapeList[o].type){if(c=n.get(this.shapeList[o],"dataIndex"),l=e[d],i[d][2]&&c===l.data.length-1){this.zr.delShape(this.shapeList[o].id);continue}if(!i[d][2]&&0===c){this.zr.delShape(this.shapeList[o].id);continue}r=this.component.xAxis.getAxis(l.xAxisIndex||0).getGap(),a=i[d][2]?r:-r,h=0,this.zr.animate(this.shapeList[o].id,"").when(this.query(this.option,"animationDurationUpdate"),{position:[a,h]}).start()}}},a.inherits(e,i),t("../chart").define("k",e),e});