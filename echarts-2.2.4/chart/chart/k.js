define("echarts/chart/k",["require","./base","../util/shape/Candle","../component/axis","../component/grid","../component/dataZoom","../config","../util/ecData","zrender/tool/util","../chart"],function(t){function e(t,e,o,n,s){i.call(this,t,e,o,n,s),this.refresh(n)}var i=t("./base"),o=t("../util/shape/Candle");t("../component/axis"),t("../component/grid"),t("../component/dataZoom");var n=t("../config");n.k={zlevel:0,z:2,clickable:!0,hoverable:!0,legendHoverLink:!1,xAxisIndex:0,yAxisIndex:0,itemStyle:{normal:{color:"#fff",color0:"#00aa11",lineStyle:{width:1,color:"#ff3200",color0:"#00aa11"},label:{show:!1}},emphasis:{label:{show:!1}}}};var s=t("../util/ecData"),r=t("zrender/tool/util");return e.prototype={type:n.CHART_TYPE_K,_buildShape:function(){var t=this.series;this.selectedMap={};for(var e,i={top:[],bottom:[]},o=0,s=t.length;s>o;o++)t[o].type===n.CHART_TYPE_K&&(t[o]=this.reformOption(t[o]),this.legendHoverLink=t[o].legendHoverLink||this.legendHoverLink,e=this.component.xAxis.getAxis(t[o].xAxisIndex),e.type===n.COMPONENT_TYPE_AXIS_CATEGORY&&i[e.getPosition()].push(o));for(var r in i)i[r].length>0&&this._buildSinglePosition(r,i[r]);this.addShapeList()},_buildSinglePosition:function(t,e){var i=this._mapData(e),o=i.locationMap,n=i.maxDataLength;if(0!==n&&0!==o.length){this._buildHorizontal(e,n,o);for(var s=0,r=e.length;r>s;s++)this.buildMark(e[s])}},_mapData:function(t){for(var e,i,o=this.series,n=this.component.legend,s=[],r=0,a=0,h=t.length;h>a;a++)e=o[t[a]],i=e.name,this.selectedMap[i]=n?n.isSelected(i):!0,this.selectedMap[i]&&s.push(t[a]),r=Math.max(r,e.data.length);return{locationMap:s,maxDataLength:r}},_buildHorizontal:function(t,e,i){for(var o,n,s,r,a,h,l,d,c,p,u=this.series,g={},f=0,m=i.length;m>f;f++){o=i[f],n=u[o],s=n.xAxisIndex||0,r=this.component.xAxis.getAxis(s),l=n.barWidth||Math.floor(r.getGap()/2),p=n.barMaxWidth,p&&l>p&&(l=p),a=n.yAxisIndex||0,h=this.component.yAxis.getAxis(a),g[o]=[];for(var y=0,_=e;_>y&&null!=r.getNameByIndex(y);y++)d=n.data[y],c=this.getDataFromOption(d,"-"),"-"!==c&&4==c.length&&g[o].push([r.getCoordByIndex(y),l,h.getCoord(c[0]),h.getCoord(c[1]),h.getCoord(c[2]),h.getCoord(c[3]),y,r.getNameByIndex(y)])}this._buildKLine(t,g)},_buildKLine:function(t,e){for(var i,o,s,r,a,h,l,d,c,p,u,g,f,m,y,_,v,x=this.series,b=0,S=t.length;S>b;b++)if(v=t[b],u=x[v],m=e[v],this._isLarge(m)&&(m=this._getLargePointList(m)),u.type===n.CHART_TYPE_K&&null!=m){g=u,i=this.query(g,"itemStyle.normal.lineStyle.width"),o=this.query(g,"itemStyle.normal.lineStyle.color"),s=this.query(g,"itemStyle.normal.lineStyle.color0"),r=this.query(g,"itemStyle.normal.color"),a=this.query(g,"itemStyle.normal.color0"),h=this.query(g,"itemStyle.emphasis.lineStyle.width"),l=this.query(g,"itemStyle.emphasis.lineStyle.color"),d=this.query(g,"itemStyle.emphasis.lineStyle.color0"),c=this.query(g,"itemStyle.emphasis.color"),p=this.query(g,"itemStyle.emphasis.color0");for(var T=0,z=m.length;z>T;T++)y=m[T],f=u.data[y[6]],g=f,_=y[3]<y[2],this.shapeList.push(this._getCandle(v,y[6],y[7],y[0],y[1],y[2],y[3],y[4],y[5],_?this.query(g,"itemStyle.normal.color")||r:this.query(g,"itemStyle.normal.color0")||a,this.query(g,"itemStyle.normal.lineStyle.width")||i,_?this.query(g,"itemStyle.normal.lineStyle.color")||o:this.query(g,"itemStyle.normal.lineStyle.color0")||s,_?this.query(g,"itemStyle.emphasis.color")||c||r:this.query(g,"itemStyle.emphasis.color0")||p||a,this.query(g,"itemStyle.emphasis.lineStyle.width")||h||i,_?this.query(g,"itemStyle.emphasis.lineStyle.color")||l||o:this.query(g,"itemStyle.emphasis.lineStyle.color0")||d||s))}},_isLarge:function(t){return t[0][1]<.5},_getLargePointList:function(t){for(var e=this.component.grid.getWidth(),i=t.length,o=[],n=0;e>n;n++)o[n]=t[Math.floor(i/e*n)];return o},_getCandle:function(t,e,i,n,r,a,h,l,d,c,p,u,g,f,m){var y=this.series,_=y[t],v=_.data[e],x=[v,_],b={zlevel:this.getZlevelBase(),z:this.getZBase(),clickable:this.deepQuery(x,"clickable"),hoverable:this.deepQuery(x,"hoverable"),style:{x:n,y:[a,h,l,d],width:r,color:c,strokeColor:u,lineWidth:p,brushType:"both"},highlightStyle:{color:g,strokeColor:m,lineWidth:f},_seriesIndex:t};return b=this.addLabel(b,_,v,i),s.pack(b,_,t,v,e,i),b=new o(b)},getMarkCoord:function(t,e){var i=this.series[t],o=this.component.xAxis.getAxis(i.xAxisIndex),n=this.component.yAxis.getAxis(i.yAxisIndex);return["string"!=typeof e.xAxis&&o.getCoordByIndex?o.getCoordByIndex(e.xAxis||0):o.getCoord(e.xAxis||0),"string"!=typeof e.yAxis&&n.getCoordByIndex?n.getCoordByIndex(e.yAxis||0):n.getCoord(e.yAxis||0)]},refresh:function(t){t&&(this.option=t,this.series=t.series),this.backupShapeList(),this._buildShape()},addDataAnimation:function(t,e){function i(){g--,0===g&&e&&e()}for(var o=this.series,n={},r=0,a=t.length;a>r;r++)n[t[r][0]]=t[r];for(var h,l,d,c,p,u,g=0,r=0,a=this.shapeList.length;a>r;r++)if(p=this.shapeList[r]._seriesIndex,n[p]&&!n[p][3]&&"candle"===this.shapeList[r].type){if(u=s.get(this.shapeList[r],"dataIndex"),c=o[p],n[p][2]&&u===c.data.length-1){this.zr.delShape(this.shapeList[r].id);continue}if(!n[p][2]&&0===u){this.zr.delShape(this.shapeList[r].id);continue}l=this.component.xAxis.getAxis(c.xAxisIndex||0).getGap(),h=n[p][2]?l:-l,d=0,g++,this.zr.animate(this.shapeList[r].id,"").when(this.query(this.option,"animationDurationUpdate"),{position:[h,d]}).done(i).start()}g||e&&e()}},r.inherits(e,i),t("../chart").define("k",e),e});