define("echarts/chart/k",["require","./base","../util/shape/Candle","../component/axis","../component/grid","../component/dataZoom","../config","../util/ecData","zrender/tool/util","../chart"],function(t){function e(t,e,o,n,r){i.call(this,t,e,o,n,r),this.refresh(n)}var i=t("./base"),o=t("../util/shape/Candle");t("../component/axis"),t("../component/grid"),t("../component/dataZoom");var n=t("../config");n.k={zlevel:0,z:2,clickable:!0,hoverable:!0,legendHoverLink:!1,xAxisIndex:0,yAxisIndex:0,itemStyle:{normal:{color:"#fff",color0:"#00aa11",lineStyle:{width:1,color:"#ff3200",color0:"#00aa11"},label:{show:!1}},emphasis:{label:{show:!1}}}};var r=t("../util/ecData"),s=t("zrender/tool/util");return e.prototype={type:n.CHART_TYPE_K,_buildShape:function(){var t=this.series;this.selectedMap={};for(var e,i={top:[],bottom:[]},o=0,r=t.length;r>o;o++)t[o].type===n.CHART_TYPE_K&&(t[o]=this.reformOption(t[o]),this.legendHoverLink=t[o].legendHoverLink||this.legendHoverLink,e=this.component.xAxis.getAxis(t[o].xAxisIndex),e.type===n.COMPONENT_TYPE_AXIS_CATEGORY&&i[e.getPosition()].push(o));for(var s in i)i[s].length>0&&this._buildSinglePosition(s,i[s]);this.addShapeList()},_buildSinglePosition:function(t,e){var i=this._mapData(e),o=i.locationMap,n=i.maxDataLength;if(0!==n&&0!==o.length){this._buildHorizontal(e,n,o);for(var r=0,s=e.length;s>r;r++)this.buildMark(e[r])}},_mapData:function(t){for(var e,i,o=this.series,n=this.component.legend,r=[],s=0,a=0,h=t.length;h>a;a++)e=o[t[a]],i=e.name,this.selectedMap[i]=n?n.isSelected(i):!0,this.selectedMap[i]&&r.push(t[a]),s=Math.max(s,e.data.length);return{locationMap:r,maxDataLength:s}},_buildHorizontal:function(t,e,i){for(var o,n,r,s,a,h,l,d,c,p,u=this.series,g={},f=0,m=i.length;m>f;f++){o=i[f],n=u[o],r=n.xAxisIndex||0,s=this.component.xAxis.getAxis(r),l=n.barWidth||Math.floor(s.getGap()/2),p=n.barMaxWidth,p&&l>p&&(l=p),a=n.yAxisIndex||0,h=this.component.yAxis.getAxis(a),g[o]=[];for(var _=0,y=e;y>_&&null!=s.getNameByIndex(_);_++)d=n.data[_],c=this.getDataFromOption(d,"-"),"-"!==c&&4==c.length&&g[o].push([s.getCoordByIndex(_),l,h.getCoord(c[0]),h.getCoord(c[1]),h.getCoord(c[2]),h.getCoord(c[3]),_,s.getNameByIndex(_)])}this._buildKLine(t,g)},_buildKLine:function(t,e){for(var i,o,r,s,a,h,l,d,c,p,u,g,f,m,_,y,v,x=this.series,b=0,S=t.length;S>b;b++)if(v=t[b],u=x[v],m=e[v],this._isLarge(m)&&(m=this._getLargePointList(m)),u.type===n.CHART_TYPE_K&&null!=m){g=u,i=this.query(g,"itemStyle.normal.lineStyle.width"),o=this.query(g,"itemStyle.normal.lineStyle.color"),r=this.query(g,"itemStyle.normal.lineStyle.color0"),s=this.query(g,"itemStyle.normal.color"),a=this.query(g,"itemStyle.normal.color0"),h=this.query(g,"itemStyle.emphasis.lineStyle.width"),l=this.query(g,"itemStyle.emphasis.lineStyle.color"),d=this.query(g,"itemStyle.emphasis.lineStyle.color0"),c=this.query(g,"itemStyle.emphasis.color"),p=this.query(g,"itemStyle.emphasis.color0");for(var T=0,z=m.length;z>T;T++)_=m[T],f=u.data[_[6]],g=f,y=_[3]<_[2],this.shapeList.push(this._getCandle(v,_[6],_[7],_[0],_[1],_[2],_[3],_[4],_[5],y?this.query(g,"itemStyle.normal.color")||s:this.query(g,"itemStyle.normal.color0")||a,this.query(g,"itemStyle.normal.lineStyle.width")||i,y?this.query(g,"itemStyle.normal.lineStyle.color")||o:this.query(g,"itemStyle.normal.lineStyle.color0")||r,y?this.query(g,"itemStyle.emphasis.color")||c||s:this.query(g,"itemStyle.emphasis.color0")||p||a,this.query(g,"itemStyle.emphasis.lineStyle.width")||h||i,y?this.query(g,"itemStyle.emphasis.lineStyle.color")||l||o:this.query(g,"itemStyle.emphasis.lineStyle.color0")||d||r))}},_isLarge:function(t){return t[0][1]<.5},_getLargePointList:function(t){for(var e=this.component.grid.getWidth(),i=t.length,o=[],n=0;e>n;n++)o[n]=t[Math.floor(i/e*n)];return o},_getCandle:function(t,e,i,n,s,a,h,l,d,c,p,u,g,f,m){var _=this.series,y=_[t],v=y.data[e],x=[v,y],b={zlevel:y.zlevel,z:y.z,clickable:this.deepQuery(x,"clickable"),hoverable:this.deepQuery(x,"hoverable"),style:{x:n,y:[a,h,l,d],width:s,color:c,strokeColor:u,lineWidth:p,brushType:"both"},highlightStyle:{color:g,strokeColor:m,lineWidth:f},_seriesIndex:t};return b=this.addLabel(b,y,v,i),r.pack(b,y,t,v,e,i),b=new o(b)},getMarkCoord:function(t,e){var i=this.series[t],o=this.component.xAxis.getAxis(i.xAxisIndex),n=this.component.yAxis.getAxis(i.yAxisIndex);return["string"!=typeof e.xAxis&&o.getCoordByIndex?o.getCoordByIndex(e.xAxis||0):o.getCoord(e.xAxis||0),"string"!=typeof e.yAxis&&n.getCoordByIndex?n.getCoordByIndex(e.yAxis||0):n.getCoord(e.yAxis||0)]},refresh:function(t){t&&(this.option=t,this.series=t.series),this.backupShapeList(),this._buildShape()},addDataAnimation:function(t,e){function i(){g--,0===g&&e&&e()}for(var o=this.series,n={},s=0,a=t.length;a>s;s++)n[t[s][0]]=t[s];for(var h,l,d,c,p,u,g=0,s=0,a=this.shapeList.length;a>s;s++)if(p=this.shapeList[s]._seriesIndex,n[p]&&!n[p][3]&&"candle"===this.shapeList[s].type){if(u=r.get(this.shapeList[s],"dataIndex"),c=o[p],n[p][2]&&u===c.data.length-1){this.zr.delShape(this.shapeList[s].id);continue}if(!n[p][2]&&0===u){this.zr.delShape(this.shapeList[s].id);continue}l=this.component.xAxis.getAxis(c.xAxisIndex||0).getGap(),h=n[p][2]?l:-l,d=0,g++,this.zr.animate(this.shapeList[s].id,"").when(this.query(this.option,"animationDurationUpdate"),{position:[h,d]}).done(i).start()}g||e&&e()}},s.inherits(e,i),t("../chart").define("k",e),e});