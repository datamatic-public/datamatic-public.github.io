define("echarts/chart/eventRiver",["require","./base","../layout/eventRiver","zrender/shape/Polygon","../component/axis","../component/grid","../component/dataZoom","../config","../util/ecData","../util/date","zrender/tool/util","zrender/tool/color","../chart"],function(t){function e(t,e,o,s,a){i.call(this,t,e,o,s,a);var r=this;r._ondragend=function(){r.isDragend=!0},this.refresh(s)}var i=t("./base"),o=t("../layout/eventRiver"),s=t("zrender/shape/Polygon");t("../component/axis"),t("../component/grid"),t("../component/dataZoom");var a=t("../config");a.eventRiver={zlevel:0,z:2,clickable:!0,legendHoverLink:!0,itemStyle:{normal:{borderColor:"rgba(0,0,0,0)",borderWidth:1,label:{show:!0,position:"inside",formatter:"{b}"}},emphasis:{borderColor:"rgba(0,0,0,0)",borderWidth:1,label:{show:!0}}}};var r=t("../util/ecData"),n=t("../util/date"),h=t("zrender/tool/util"),l=t("zrender/tool/color");return e.prototype={type:a.CHART_TYPE_EVENTRIVER,_buildShape:function(){var t=this.series;this.selectedMap={},this._dataPreprocessing();for(var e=this.component.legend,i=[],s=0;s<t.length;s++)if(t[s].type===this.type){t[s]=this.reformOption(t[s]),this.legendHoverLink=t[s].legendHoverLink||this.legendHoverLink;var a=t[s].name||"";if(this.selectedMap[a]=e?e.isSelected(a):!0,!this.selectedMap[a])continue;this.buildMark(s),i.push(this.series[s])}o(i,this._intervalX,this.component.grid.getArea()),this._drawEventRiver(),this.addShapeList()},_dataPreprocessing:function(){for(var t,e,i=this.series,o=0,s=i.length;s>o;o++)if(i[o].type===this.type){t=this.component.xAxis.getAxis(i[o].xAxisIndex||0);for(var a=0,r=i[o].data.length;r>a;a++){e=i[o].data[a].evolution;for(var h=0,l=e.length;l>h;h++)e[h].timeScale=t.getCoord(n.getNewDate(e[h].time)-0),e[h].valueScale=Math.pow(e[h].value,.8)}}this._intervalX=Math.round(this.component.grid.getWidth()/40)},_drawEventRiver:function(){for(var t=this.series,e=0;e<t.length;e++){var i=t[e].name||"";if(t[e].type===this.type&&this.selectedMap[i])for(var o=0;o<t[e].data.length;o++)this._drawEventBubble(t[e].data[o],e,o)}},_drawEventBubble:function(t,e,i){var o=this.series,a=o[e],n=a.name||"",h=a.data[i],d=[h,a],c=this.component.legend,p=c?c.getColor(n):this.zr.getColor(e),u=this.deepMerge(d,"itemStyle.normal")||{},g=this.deepMerge(d,"itemStyle.emphasis")||{},f=this.getItemStyleColor(u.color,e,i,h)||p,m=this.getItemStyleColor(g.color,e,i,h)||("string"==typeof f?l.lift(f,-.2):f),y=this._calculateControlPoints(t),_={zlevel:a.zlevel,z:a.z,clickable:this.deepQuery(d,"clickable"),style:{pointList:y,smooth:"spline",brushType:"both",lineJoin:"round",color:f,lineWidth:u.borderWidth,strokeColor:u.borderColor},highlightStyle:{color:m,lineWidth:g.borderWidth,strokeColor:g.borderColor},draggable:"vertical",ondragend:this._ondragend};_=new s(_),this.addLabel(_,a,h,t.name),r.pack(_,o[e],e,o[e].data[i],i,o[e].data[i].name),this.shapeList.push(_)},_calculateControlPoints:function(t){var e=this._intervalX,i=t.y,o=t.evolution,s=o.length;if(!(1>s)){for(var a=[],r=[],n=0;s>n;n++)a.push(o[n].timeScale),r.push(o[n].valueScale);var h=[];h.push([a[0],i]);var n=0;for(n=0;s-1>n;n++)h.push([(a[n]+a[n+1])/2,r[n]/-2+i]);for(h.push([(a[n]+(a[n]+e))/2,r[n]/-2+i]),h.push([a[n]+e,i]),h.push([(a[n]+(a[n]+e))/2,r[n]/2+i]),n=s-1;n>0;n--)h.push([(a[n]+a[n-1])/2,r[n-1]/2+i]);return h}},ondragend:function(t,e){this.isDragend&&t.target&&(e.dragOut=!0,e.dragIn=!0,e.needRefresh=!1,this.isDragend=!1)},refresh:function(t){t&&(this.option=t,this.series=t.series),this.backupShapeList(),this._buildShape()}},h.inherits(e,i),t("../chart").define("eventRiver",e),e}),define("echarts/layout/eventRiver",["require"],function(){function t(t,i,a){function r(t,e){var i=t.importance,o=e.importance;return i>o?-1:o>i?1:0}for(var n=4,h=0;h<t.length;h++){for(var l=0;l<t[h].data.length;l++){null==t[h].data[l].weight&&(t[h].data[l].weight=1);for(var d=0,c=0;c<t[h].data[l].evolution.length;c++)d+=t[h].data[l].evolution[c].valueScale;t[h].data[l].importance=d*t[h].data[l].weight}t[h].data.sort(r)}for(var h=0;h<t.length;h++){null==t[h].weight&&(t[h].weight=1);for(var d=0,l=0;l<t[h].data.length;l++)d+=t[h].data[l].weight;t[h].importance=d*t[h].weight}t.sort(r);for(var p=Number.MAX_VALUE,u=0,h=0;h<t.length;h++)for(var l=0;l<t[h].data.length;l++)for(var c=0;c<t[h].data[l].evolution.length;c++){var g=t[h].data[l].evolution[c].timeScale;p=Math.min(p,g),u=Math.max(u,g)}p=~~p,u=~~u;for(var f=function(){var t=u-p+1+~~i;if(0>=t)return[0];for(var e=[];t--;)e.push(0);return e}(),m=f.slice(0),y=[],_=0,v=0,h=0;h<t.length;h++)for(var l=0;l<t[h].data.length;l++){var x=t[h].data[l];x.time=[],x.value=[];for(var b,S=0,c=0;c<t[h].data[l].evolution.length;c++)b=t[h].data[l].evolution[c],x.time.push(b.timeScale),x.value.push(b.valueScale),S=Math.max(S,b.valueScale);o(x,i,p),x.y=s(m,x,function(t,e){return t.ypx[e]}),x._offset=s(f,x,function(){return n}),_=Math.max(_,x.y+S),v=Math.max(v,x._offset),y.push(x)}e(y,a,_,v)}function e(t,e,i,o){for(var s=e.height,a=o/s>.5?.5:1,r=e.y,n=(e.height-o)/i,h=0,l=t.length;l>h;h++){var d=t[h];d.y=r+n*d.y+d._offset*a,delete d.time,delete d.value,delete d.xpx,delete d.ypx,delete d._offset;for(var c=d.evolution,p=0,u=c.length;u>p;p++)c[p].valueScale*=n}}function i(t,e,i,o){if(t===i)throw new Error("x0 is equal with x1!!!");if(e===o)return function(){return e};var s=(e-o)/(t-i),a=(o*t-e*i)/(t-i);return function(t){return s*t+a}}function o(t,e,o){var s=~~e,a=t.time.length;t.xpx=[],t.ypx=[];for(var r,n=0,h=0,l=0,d=0,c=0;a>n;n++){h=~~t.time[n],d=t.value[n]/2,n===a-1?(l=h+s,c=0):(l=~~t.time[n+1],c=t.value[n+1]/2),r=i(h,d,l,c);for(var p=h;l>p;p++)t.xpx.push(p-o),t.ypx.push(r(p))}t.xpx.push(l-o),t.ypx.push(c)}function s(t,e,i){for(var o,s=0,a=e.xpx.length,r=0;a>r;r++)o=i(e,r),s=Math.max(s,o+t[e.xpx[r]]);for(r=0;a>r;r++)o=i(e,r),t[e.xpx[r]]=s+o;return s}return t});